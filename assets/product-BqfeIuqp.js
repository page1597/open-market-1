import"./modulepreload-polyfill-B5Qt9EMX.js";const d="https://openmarket.weniv.co.kr";let i=1,l={};const p=()=>{console.log("header.html"),fetch("header.html").then(t=>t.text()).then(t=>{document.querySelector("header").outerHTML=t,fetch("/open-market-service/manifest.json").then(n=>n.json()).then(n=>{const o=n["src/js/header.js"],e=document.createElement("script");e.src=`/open-market-service/${o}`,e.type="module",e.onload=()=>console.log("header.js 로드 완료"),e.onerror=c=>console.error("header.js 로드 실패",c),document.body.appendChild(e)})})},f=()=>{fetch("footer.html").then(t=>t.text()).then(t=>{document.querySelector("footer").outerHTML=t})};document.addEventListener("DOMContentLoaded",()=>{p(),f(),q()});const q=async()=>{try{l=await g(),console.log(l),w(l),C(l)}catch(t){console.log(t)}},g=async()=>{const t=new URL(window.location.href),o=new URLSearchParams(t.search).get("id");try{const e=await fetch(`${d}/products/${o}/`);return e.ok?await e.json():null}catch(e){return console.error("상품 불러오기 오류:",e),null}},w=t=>{j(t.stock,t.price),document.querySelector("h2").textContent=t.product_name,document.querySelector("figcaption").textContent=t.product_name;const n=document.querySelector(".product-image");n.src=t.image,n.alt=t.product_name;const o=new Intl.NumberFormat("ko-KR");document.querySelector(".store-name").textContent=t.store_name,document.querySelector(".product-name").textContent=t.product_name,document.querySelector(".product-price em").textContent=o.format(t.price),document.querySelector(".total-quantity em").textContent=i,document.querySelector(".total-price em").textContent=o.format(t.price*i),document.querySelector("section").classList.remove("hidden")},S=async t=>{const n=localStorage.getItem("token");if(!n){console.error("인증된 사용자가 아님. 토큰 없음"),alert("로그인 후 이용가능합니다."),window.location.href="./login.html";return}try{const o=await fetch(`${d}/cart/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`JWT ${n}`},body:JSON.stringify({product_id:t.product_id,quantity:i,check:!0})});if(o.ok){const e=await o.json();return console.log(e),alert("장바구니에 추가되었습니다."),confirm("장바구니로 이동하시겠습니까?")&&(window.location.href="./cart.html"),e}else{const e=await o.json();return console.error("장바구니 넣기 실패:",e),alert(e.FAIL_message),null}}catch(o){return console.error("장바구니 넣기 오류:",o),alert("장바구니에 추가하지 못했습니다. 관리자에게 문의하세요."),null}},C=t=>{document.querySelector("#add-to-cart").addEventListener("click",async()=>{S(t)})},j=(t,n)=>{const o=document.querySelector(".quantity-change-input"),e=document.querySelector("#minus"),c=document.querySelector("#plus"),m=document.querySelector(".total-quantity em"),h=document.querySelector(".total-price em");let r=1;const y=new Intl.NumberFormat("ko-KR"),a=()=>{o.value=r,m.textContent=r,h.textContent=y.format(n*r),e.disabled=r<=1,c.disabled=r>=t};o.addEventListener("input",u=>{let s=parseInt(u.target.value,10)||1;u.target.value.startsWith("0")&&(s=parseInt(u.target.value,10)),s>t&&(alert("상품 재고를 초과하였습니다."),s=t),r=s,a()}),e.addEventListener("click",()=>{r>1&&(r--,a())}),c.addEventListener("click",()=>{r<t&&(r++,a())}),a()};
